# 📓 세션 로그 — 2026-02-19

## 작업 요약

### 1. GameMap 성능 최적화 (마스터 직접 구현)

- 배경 타일 (~270개 RectangleComponent) → PictureRecorder 래스터 캐시 1개 이미지
- 도로/점선/마커 (~100+개 Component) → 래스터 캐시 1개 이미지
- `_TowerSlotVisual`의 `update()` 매 프레임 폴링 제거 → `setOccupied()` 이벤트 기반
- `_slotVisuals` 맵으로 인덱스 기반 직접 참조
- 상단 1행(HUD)/하단 1행(패널) 슬롯 생성 제외

### 2. WaveManager 리팩토링 (마스터 직접 구현)

- `addPostFrameCallback` 래핑 전면 제거 → 직접 호출
- 웨이브 기반 적 HP 스케일링 → 유저 레벨(타워+영웅) 기반 스케일링
- `nextWaveData` / `currentWaveData` getter 추가
- `_updateNextWavePreview()` HUD 데이터 전달 메서드 추가
- `GameDataLoader.enemies[id]` → `GameDataLoader.getEnemies()[id]` 변경

### 3. JARVIS 시스템 업그레이드

- SUCCESS_PATTERNS: +5 패턴 (래스터 캐시⭐, 이벤트 기반, 유저 스케일링, addPostFrameCallback 제거, 웨이브 미리보기)
- ANTI_PATTERNS: +AP-019 (update 폴링), +AP-020 (addPostFrameCallback 남용)
- DOMAIN_KNOWLEDGE: +3 용어 (Raster Cache, User Scaling, Wave Preview)
- DECISION_LOG: +ADR-006 (래스터 캐시 최적화)
- Flutter Flame SKILL.md: 래스터 캐시/이벤트 기반/스케일링 섹션 추가

## 핵심 교훈

1. **정적 시각 요소 = 이미지로 캐시** — Component 수가 곧 성능
2. **매 프레임 폴링은 안티패턴** — 상태 변경 시점에 통지
3. **addPostFrameCallback은 빌드 페이즈 내부에서만 필요** — Flame 게임 루프에서는 불필요
4. **난이도 스케일링은 유저 상태 기반** — 웨이브 번호 기반은 리니어하여 비직관적

## 다음 작업 예정

- [ ] 웨이브 미리보기 HUD UI 구현
- [ ] 일시정지/배속 UI
- [ ] 영웅 고유 스킬 시스템

---

**작성**: @JARVIS
